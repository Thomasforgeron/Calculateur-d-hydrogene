<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>RÃ©sultat final</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>RÃ©sultat final</h1>
  <div id="resultat"></div>

  <script>
    const PCI_H2 = 33.33;
    let h2 = PCI_H2;
    let energieTotale = 0;
    let co2Total = 0;

    let log = [];

    // Ã‰tape 8 â€“ Utilisation finale (pertes)
    const pertes8 = parseFloat(localStorage.getItem('etape8_pertes') || 0);
    h2 /= (1 - pertes8 / 100);
    log.push(`<b>Ã‰tape 8</b> â€“ Pertes dâ€™utilisation : ${pertes8}% â†’ Hâ‚‚ = ${h2.toFixed(2)} kWh`);

    // Ã‰tape 7 â€“ Conversion en Ã©lectricitÃ©
    const pertes7 = parseFloat(localStorage.getItem('etape7_pertes') || 0);
    const consoSuppl7 = parseFloat(localStorage.getItem('etape7_conso') || 0);
    h2 /= (1 - pertes7 / 100);
    const conso7 = (h2 / PCI_H2) * consoSuppl7;
    energieTotale += conso7;
    log.push(`<b>Ã‰tape 7</b> â€“ Pertes conversion : ${pertes7}%, Conso supp : ${consoSuppl7} â†’ +${conso7.toFixed(3)} kWh, Hâ‚‚ = ${h2.toFixed(2)}`);

    // Ã‰tape 6 â€“ Distribution
    const energie6 = parseFloat(localStorage.getItem('etape6_energie') || 0);
    const conso6 = (h2 / PCI_H2) * energie6;
    energieTotale += conso6;
    log.push(`<b>Ã‰tape 6</b> â€“ Distribution (${energie6} kWh/kg) â†’ +${conso6.toFixed(3)} kWh`);

    // Ã‰tape 5 â€“ Transport
    const distance5 = parseFloat(localStorage.getItem('etape5_distance') || 0);
    const emission5 = parseFloat(localStorage.getItem('etape5_emission') || 0);
    const co2_5 = (h2 / 1000) * distance5 * emission5 / 1000; // convertit g en kg
    co2Total += co2_5;
    log.push(`<b>Ã‰tape 5</b> â€“ Transport sur ${distance5} km Ã  ${emission5} gCOâ‚‚/t.km â†’ +${(co2_5 * 1000).toFixed(1)} gCOâ‚‚`);

    // Ã‰tape 4 â€“ Stockage
    const pertesJour4 = parseFloat(localStorage.getItem('etape4_pertes') || 0);
    const jours4 = parseInt(localStorage.getItem('etape4_jours') || 0);
    const consoStock4 = parseFloat(localStorage.getItem('etape4_conso') || 0);
    const facteurStock = Math.pow(1 - pertesJour4 / 100, jours4);
    h2 /= facteurStock;
    const conso4 = (h2 / PCI_H2) * ((consoStock4 / 30) * jours4);
    energieTotale += conso4;
    log.push(`<b>Ã‰tape 4</b> â€“ Stockage (${pertesJour4}%/j sur ${jours4} j) â†’ +${conso4.toFixed(3)} kWh, Hâ‚‚ = ${h2.toFixed(2)}`);

    // Ã‰tape 3 â€“ Compression / liquÃ©faction
    const energie3 = parseFloat(localStorage.getItem('etape3_energie') || 0);
    const conso3 = (h2 / PCI_H2) * energie3;
    energieTotale += conso3;
    log.push(`<b>Ã‰tape 3</b> â€“ Compression/liquÃ©faction (${energie3} kWh/kg) â†’ +${conso3.toFixed(3)} kWh`);

    // Ã‰tape 2 â€“ Production
    const energie2 = parseFloat(localStorage.getItem('etape2_energie') || 0);
    const co2_kg2 = parseFloat(localStorage.getItem('etape2_co2') || 0);
    const conso2 = (h2 / PCI_H2) * energie2;
    const co2_2 = (h2 / PCI_H2) * co2_kg2;
    energieTotale += conso2;
    co2Total += co2_2;
    log.push(`<b>Ã‰tape 2</b> â€“ Production â†’ +${conso2.toFixed(2)} kWh, +${co2_2.toFixed(3)} kgCOâ‚‚`);

    // Ã‰tape 1 â€“ Construction
    const co2_constr = parseFloat(localStorage.getItem('etape1_construction') || 0);
    const co2_1 = (h2 / PCI_H2) * co2_constr;
    co2Total += co2_1;
    log.push(`<b>Ã‰tape 1</b> â€“ Construction â†’ +${co2_1.toFixed(3)} kgCOâ‚‚`);

    // RÃ©sultat global
    const couleur = co2Total < 1 ? 'ðŸŸ¢ HydrogÃ¨ne vert' : co2Total < 5 ? 'ðŸ”µ HydrogÃ¨ne bleu' : 'âš« HydrogÃ¨ne gris';

    document.getElementById('resultat').innerHTML = `
      <p><strong>HydrogÃ¨ne final visÃ© :</strong> 1 kg (33,33 kWh)</p>
      <p><strong>QuantitÃ© totale produite :</strong> ${h2.toFixed(2)} kg Hâ‚‚</p>
      <p><strong>Ã‰nergie totale consommÃ©e :</strong> ${energieTotale.toFixed(2)} kWh</p>
      <p><strong>Ã‰missions totales :</strong> ${co2Total.toFixed(3)} kg COâ‚‚</p>
      <p><strong>Classification :</strong> ${couleur}</p>
      <hr>
      ${log.join('<br>')}
    `;
  </script>
</body>
</html>

